<!DOCTYPE html>
<html>

  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>MySQL基本知识</title>

	<link rel="stylesheet" href="/styles/css/index.css">
	<link rel="stylesheet" href="/styles/css/fontawesome/css/font-awesome.min.css">
	<link rel="canonical" href="/2017/05/13/MySQL%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/">
	<link rel="alternate" type="application/rss+xml" title="Jun Xi Gu 的博客" href="/feed.xml">
	
	<meta name="description" content="顾俊喜;个人博客">

	<script src="/styles/js/jquery.min.js"></script>
	<!--[if lt IE 9]>
    	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  	<![endif]-->
  	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?94be4b0f9fc5d94cc0d0415ea6761ae9";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
  	<style type="text/css">
	  	.docs-content{
	  		margin-bottom: 10px;
	  	}
  	</style>
</head>

  <body class="index">

    <header class="navbar navbar-inverse navbar-fixed-top docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">    
        <li>
          <a href="/">主页</a>
        </li>
        <li>
          <a href="/categories/">分类博客</a>
        </li>
        <li>
          <a href="/tag">标签博客</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">关于<b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a rel="nofollow" target="_blank" href="https://github.com/junxigu/">Github</a></li>
            <li><a rel="nofollow" target="_blank" href="https://github.com/luoyan35714/LessOrMore.git">本博客模板</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header>
    <div class="docs-header" id="content">
  <div class="container">
  	
  		<!--
		    <h1>MySQL基本知识</h1>
		    <p>Post on May 13, 2017 by <a href="/about">Jun Xi Gu</a></p>
		-->
		    <h1>Stay Hungry Stay Foolish</h1>
    
  </div>
</div>
    
      
<div class="banner">
  <div class="container">
  	
    	<a href="/categories/#MySQL-ref">MySQL</a>	/
    	<a href="/tag/#MySQL-ref">MySQL</a>
    
  </div>
</div>

    

    <div class="container docs-container">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar hidden-print" role="complementary">
        <div id="navigation">
  <h1>目录</h1>
  <ul class="nav sidenav">
<!--
    
      
      
      
      

      
        <li><a href="#year_2017">2017</a>
          <ul class="nav">
            <li><a href="#month_2017_May">May</a></li>
      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_February">February</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_January">January</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
        
            </ul>
          </li>
          <li><a href="#year_2016">2016</a>
            <ul class="nav">
              <li><a href="#month_2016_December">December</a></li>
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2016_November">November</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2016_October">October</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2016_September">September</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            </ul>
          </li>
      
    
-->
  </ul>
</div> 
      </div>
    </div>
    <div class="col-md-9" role="main">
      <div class="panel docs-content">
        <div class="wrapper">
            <header class="post-header">
              <h1 class="post-title">MySQL基本知识</h1>
              <!--
                <p class="post-meta">May 13, 2017</p>
              -->
              <div class="meta">Posted on <span class="postdate">May 13, 2017</span> By <a target="_blank" href="">Jun Xi Gu</a></div>
              <br />
            </header>
            <article class="post-content">
              <ul id="markdown-toc">
  <li><a href="#operate-database" id="markdown-toc-operate-database">Operate Database</a>    <ul>
      <li><a href="#常用命令用例" id="markdown-toc-常用命令用例">常用命令用例</a></li>
    </ul>
  </li>
  <li><a href="#create-update-and-drop-table" id="markdown-toc-create-update-and-drop-table">create, update and drop table</a>    <ul>
      <li><a href="#常用命令用例-1" id="markdown-toc-常用命令用例-1">常用命令用例</a></li>
    </ul>
  </li>
  <li><a href="#index" id="markdown-toc-index">index</a>    <ul>
      <li><a href="#常用命令用例-2" id="markdown-toc-常用命令用例-2">常用命令用例</a></li>
    </ul>
  </li>
  <li><a href="#view" id="markdown-toc-view">view</a>    <ul>
      <li><a href="#常用命令用例-3" id="markdown-toc-常用命令用例-3">常用命令用例</a></li>
    </ul>
  </li>
  <li><a href="#trigger" id="markdown-toc-trigger">Trigger</a>    <ul>
      <li><a href="#常用命令用例-4" id="markdown-toc-常用命令用例-4">常用命令用例</a></li>
    </ul>
  </li>
  <li><a href="#select" id="markdown-toc-select">Select</a>    <ul>
      <li><a href="#常用命令用例-5" id="markdown-toc-常用命令用例-5">常用命令用例</a></li>
    </ul>
  </li>
  <li><a href="#insert-update-and-delete" id="markdown-toc-insert-update-and-delete">insert, update and delete</a>    <ul>
      <li><a href="#常用命令用例-6" id="markdown-toc-常用命令用例-6">常用命令用例</a></li>
    </ul>
  </li>
  <li><a href="#mysql-functions" id="markdown-toc-mysql-functions">MySQL functions</a>    <ul>
      <li><a href="#常用命令用例-7" id="markdown-toc-常用命令用例-7">常用命令用例</a></li>
    </ul>
  </li>
  <li><a href="#store-procedure--store-function" id="markdown-toc-store-procedure--store-function">Store Procedure &amp; Store Function</a>    <ul>
      <li><a href="#常用命令用例-8" id="markdown-toc-常用命令用例-8">常用命令用例</a></li>
    </ul>
  </li>
  <li><a href="#user-management" id="markdown-toc-user-management">User Management</a>    <ul>
      <li><a href="#常用命令用例-9" id="markdown-toc-常用命令用例-9">常用命令用例</a></li>
    </ul>
  </li>
  <li><a href="#backup--recovery" id="markdown-toc-backup--recovery">Backup &amp; Recovery</a>    <ul>
      <li><a href="#常用命令用例-10" id="markdown-toc-常用命令用例-10">常用命令用例</a></li>
    </ul>
  </li>
  <li><a href="#log" id="markdown-toc-log">Log</a>    <ul>
      <li><a href="#常用命令用例-11" id="markdown-toc-常用命令用例-11">常用命令用例</a></li>
    </ul>
  </li>
  <li><a href="#performance" id="markdown-toc-performance">Performance</a>    <ul>
      <li><a href="#常用命令用例-12" id="markdown-toc-常用命令用例-12">常用命令用例</a></li>
    </ul>
  </li>
</ul>

<p><strong>本文是对MySQL入门知识的总结，包括一些MySQL常见命令的示例</strong></p>

<hr />

<h1 id="operate-database">Operate Database</h1>

<p>各种存储引擎各有特点，相对MyISAM和Memory，InnoDB支持事务，外键，表修复和并发控制，但磁盘和内存占用大，插入速度慢；Memory一般只用于临时表且表的大小受限</p>

<p><strong>存储引擎的比较</strong></p>

<table>
  <thead>
    <tr>
      <th>特性</th>
      <th>InnoDB</th>
      <th>MyISAM</th>
      <th>MEMORY</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>事务安全</td>
      <td>支持</td>
      <td>无</td>
      <td>无</td>
    </tr>
    <tr>
      <td>存储限制</td>
      <td>64TB</td>
      <td>有</td>
      <td>有</td>
    </tr>
    <tr>
      <td>空间占用</td>
      <td>高</td>
      <td>低</td>
      <td>低</td>
    </tr>
    <tr>
      <td>内存占用</td>
      <td>高</td>
      <td>低</td>
      <td>高</td>
    </tr>
    <tr>
      <td>插入数据速度</td>
      <td>低</td>
      <td>高</td>
      <td>高</td>
    </tr>
    <tr>
      <td>支持外建</td>
      <td>支持</td>
      <td>无</td>
      <td>无</td>
    </tr>
  </tbody>
</table>

<h2 id="常用命令用例">常用命令用例</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>-- start mysql server
mysqld_safe --user=root

-- shutdown the server
mysqladmin -u root shutdown

-- connect to mysql server
mysql -h localhost -uroot -p;

create database example;

show databases;

-- show current database
select database();

drop database example;

-- show all engines
show engines \G

-- 

</code></pre>
</div>

<h1 id="create-update-and-drop-table">create, update and drop table</h1>

<h2 id="常用命令用例-1">常用命令用例</h2>

<p><em>创建表</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>
create table student (
    num int(10) primary key,
    name varchar(20) not null,
    sex varchar(4),
    birthday datetime,
    address varchar(50)
);

create table grade (
    id int(10) primary key auto_increment,
    course varchar(10) not null,
    s_num int(10) not null,
    grade varchar(4),
    constraint s_sum foreign key(s_num) references student(num)
);

</code></pre>
</div>

<p><em>修改表结构</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>
alter table grade modify course varchar(20);

alter table grade modify s_num int(10) after id;

desc grade;

alter table grade change grade score varchar(4);

alter table grade drop foreign key s_sum;

show create table grade \G

alter table grade engine=myisam;

alter table student drop address;

alter table student add phone int(10);

alter table grade rename gradeInfo;

alter table gradeInfo add constraint s_num foreign key(s_num) references student(num);

</code></pre>
</div>

<p><code class="highlighter-rouge">drop table student;</code></p>

<h1 id="index">index</h1>

<p>索引有两种实现类型：B树和哈希表，InnoDB和MyISAM支持B树，Memory支持哈希表(默认)和B树；索引能提高条件查询，分组，排序和表连接查询的速度；但在插入数据时需要维护索引增加时长</p>

<p>索引类型：</p>

<ul>
  <li>普通索引</li>
  <li>唯一性索引：性能比普通索引要高</li>
  <li>全文索引：针对字符型的表属性</li>
  <li>单列索引</li>
  <li>多列索引</li>
  <li>空间索引</li>
</ul>

<p>索引的使用原则：</p>

<ul>
  <li>尽量使用唯一索引</li>
  <li>为经常需要排序，分组，连接或作为查询条件的属性建立索引</li>
  <li>限制索引的数目</li>
  <li>尽量使用属性的前段部分为索引而非全文索引</li>
  <li>删除不再使用的索引</li>
</ul>

<p><strong>Key和Index的不同</strong>
在关系模型中Key可以理解为一种约束关系，比如主键要求唯一确定一个记录，外键要求记录连接到其他记录；而索引是为了加速查询，并且帮助实现约束，比如唯一索引能帮助实现唯一约束；MySQL中Key同时也是索引<br />
<a href="http://discuss.fogcreek.com/joelonsoftware5/default.asp?cmd=show&amp;ixPost=152398">详情参考</a></p>

<h2 id="常用命令用例-2">常用命令用例</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>
create database job;

-- 创建表时创建索引

CREATE TABLE user (
    userid int(10) NOT NULL AUTO_INCREMENT,
    username varchar(20) NOT NULL,
    passwd varchar(20) NOT NULL,
    info text,
    PRIMARY KEY (userid),
    unique index index_uid(userid desc),
    index index_user(username, passwd),
    fulltext index index_info(info)
);

CREATE TABLE information (
    id int(10) NOT NULL AUTO_INCREMENT,
    name varchar(20) NOT NULL,
    sex varchar(4) NOT NULL,
    birthday date DEFAULT NULL,
    address varchar(50) DEFAULT NULL,
    tel varchar(20) DEFAULT NULL,
    pic blob,
    PRIMARY KEY (id)
);

create index index_name on information(name(10));

create index index_bir on information(birthday, address);

-- 查看索引在查询中的使用情况
explain select * from information where birthday='' \G

alter table information add unique index index_id(id asc);

drop index index_user on user;

drop index index_name on information;

</code></pre>
</div>

<h1 id="view">view</h1>

<p>视图的作用：</p>

<ul>
  <li>简化操作</li>
  <li>增加数据的安全性</li>
  <li>提高表的逻辑独立性</li>
</ul>

<h2 id="常用命令用例-3">常用命令用例</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>
CREATE TABLE work_info (
  id int(10) NOT NULL,
  name varchar(20) NOT NULL,
  sex varchar(4) NOT NULL,
  age int(5) DEFAULT NULL,
  address varchar(50) DEFAULT NULL,
  tel varchar(20) DEFAULT NULL,
  PRIMARY KEY (id)
);

insert into work_info values
(1, 'zhang san', M, 18, 'beijing haidian'  , 1234567)
(2, 'li si'    , M, 22, 'beijing changping', 2345678)
(3, 'wang wu'  , F, 17, 'hunan yongzhou'   , 3456789)
(4, 'zhao liu' , F, 25, 'liaoning buxin'   , 4567890);

create algorithm=merge view info_view(id, name, sex, address)
as select id, name, sex, address from work_info where age &gt; 20
with local check option;
-- ALGORITHM有三个值：MERGE、TEMPTABLE或UNDEFINCED，默认值是UNDEFINED
-- MERGE：将查询视图的语句与视图的定义语句合并处理
-- TEMPTABLE：视图查询的结果保存到临时表，而后在该临时表基础上执行查询视图的语句，对于视图的查询条件会在临时表上进行，包括传统的WHERE子句，以及像MERGE方式无法支持的DISTINCT、GROUP BY、HAVING等
-- UNDEFINED：由MySQL选择使用哪种算法，一般会首选MERGE，因为MERGE更有效率，而且TEMPTABLE不支持更新
-- with check option 是在通过view来更新表的时候进行约束，当更新表的结果能被视图查询出来则更新表的操作成功，否则失败
-- WITH LOCAL/cascade CHECK OPTION：当视图是根据另一个视图定义的时，LOCAL和CASCADED关键字决定了检查测试的范围。LOCAL关键字对CHECK OPTION进行了限制，使其仅作用在定义的视图上，CASCADED会对将进行评估的基表进行检查

select * from info_view;

create or replace algorithm=merge view info_view(id, name, sex, address)
as select id, name, sex, address from work_info where age &lt; 20
with local check option;

update info_view set sex='M' where id=3;

drop view if exists info_view cascade;

</code></pre>
</div>

<h1 id="trigger">Trigger</h1>

<p>在表中对update，delete，insert操作进行监听并注册触发器，当监听的操作执行前或后触发触发器</p>

<h2 id="常用命令用例-4">常用命令用例</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>
create table product (
    id int(10) primary key,
    name varchar(20) not null,
    functiono varchar(50),
    company varchar(20) not null,
    address varchar(50)
);

create table operate (
    op_id int(10) primary key auto_increment,
    op_type varchar(20) not null,
    op_time time not null
);

create trigger product_bf_insert 
before insert on product for each row
insert into operate values(null, 'before insert', current_time());

create trigger product_af_update
after update on product for each row
insert into operate values(null, 'after update', current_time());

create trigger product_af_del
after delete on product for each row
insert into operate values(null, 'after delete', current_time());

delimiter @

create trigger product_bf_del
before delete on product for each row
begin
insert into operate values(null, 'before delete', current_time());
end@

delimiter ;

insert into product
values(1,'p1','f1','c1','a1');

update product set name='p2';

drop trigger product_bf_insert;

drop trigger product_af_update;

drop trigger product_af_del;

show triggers \G

select * from information_schema.triggers \G

</code></pre>
</div>

<h1 id="select">Select</h1>

<h2 id="常用命令用例-5">常用命令用例</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>
create table student (
    id int(10) primary key,
    name varchar(20) not null,
    sex varchar(4),
    birth year,
    department varchar(20) not null,
    address varchar(50)
);

create table score (
    id int(10) primary key auto_increment,
    stu_id int(10) not null,
    c_name varchar(10),
    grade int(10)
);

insert into student values(901, 'zhanglaoda', 'male', 1985, 'computer science', 'beijing haidian');
insert into student values(902, 'zhanglaoer', 'male', 1986, 'chinese', 'beijing haidian');
insert into student values(903, 'zhangsan', 'f', 1990, 'chinese', 'hunan yongzhou');
insert into student values(904, 'lisi', 'male', 1990, 'english', 'liaoning buxin');
insert into student values(905, 'wangwu', 'f', 1991, 'english', 'fujian xiamen');
insert into student values(906, 'wangliu', 'male', 1988, 'computer science', 'hunan hengyang');

insert into score values(1, 901, 'computer', 98);
insert into score values(2, 901, 'english', 80);
insert into score values(3, 902, 'computer', 65);
insert into score values(4, 902, 'chinese', 88);
insert into score values(5, 903, 'chinese', 95);
insert into score values(6, 904, 'computer', 70);
insert into score values(7, 904, 'english', 92);
insert into score values(8, 905, 'english', 94);
insert into score values(9, 906, 'computer', 90);
insert into score values(10, 906, 'english', 85);

select * from student;

-- limit offset, rows 第一个记录的偏移(0开始)和行数
select * from student limit 1, 3;

select id, name, department from student;

select * from student where department in ('computer science', 'english');

select * from student where year(now()) - birth between 18 and 22;

select department, count(department) from student group by department;

select c_name, max(grade) from score group by c_name;

select c_name, grade from score left join student as stu on stu_id = stu.id where name = 'lisi';

select * from student left join score on student.id = score.stu_id;

select stu_id, sum(grade) from score group by stu_id;

select c_name, avg(grade) from score group by c_name;

select * from student where id in (select stu_id from score where c_name = 'computer' and grade &lt; 95);

select * from student where id in (select stu_id from score where c_name = 'computer' and stu_id in (select stu_id from score where c_name = 'english'));

select grade from score where c_name='computer' order by grade desc;

select id from student union select stu_id from score;

-- like语法的通配符包括：%(匹配任意字符串), _(匹配任意字符), [], [^]
select name, department, c_name, grade from student as stu left join score as s on stu.id=s.stu_id where name regexp '^(zhang|wang)';

select name, year(now()) - birth as age, department, c_name, grade from student as stu left join score as s on stu.id=s.stu_id where address regexp '^hunan';

</code></pre>
</div>

<h1 id="insert-update-and-delete">insert, update and delete</h1>

<h2 id="常用命令用例-6">常用命令用例</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>
create table food (
    id int(10) primary key auto_increment,
    name varchar(20) not null,
    company varchar(30) not null,
    price float,
    produce_time year,
    validity_time int(4),
    address varchar(50)
);

insert into food
values(null, 'AA cookie', 'AA factory', 2.5, 2008, 3, 'beijing'),
(null, 'CC Milk', 'CC factory', 3.5, 2009, 1, 'hebei'),
(null, 'EE jelly', 'EE factory', 1.5, 2007, 2, 'beijing'),
(null, 'FF coffee', 'FF factory', 20, 2002, 5, 'tianjin'),
(null, 'GG sugar', 'GG factory', 14, 2003, 3, 'guangdong');

insert into food(name, company, price, produce_time, validity_time, address)
	select name, company, price, produce_time, validity_time, address from food;

update food
set address='neimenggu', price=3.2
where company='CC factory';

delete from food where year(now()) - produce_time &gt; validity_time;

delete from food where address='beijing';

</code></pre>
</div>

<h1 id="mysql-functions">MySQL functions</h1>

<p><a href="https://dev.mysql.com/doc/refman/5.7/en/func-op-summary-ref.html">functions手册</a></p>

<h2 id="常用命令用例-7">常用命令用例</h2>

<p><em>1-100随机整数</em></p>

<p><code class="highlighter-rouge">select round(rand()*100), floor(rand()*100), ceil(rand()*100);</code></p>

<p><em>圆周率及其正余弦，对数</em></p>

<p><code class="highlighter-rouge">select pi(), sin(pi()), cos(pi()), log(pi());</code></p>

<h1 id="store-procedure--store-function">Store Procedure &amp; Store Function</h1>

<p>在数据库中存储一份可执行代码，直接调用就能得出结果，好处包括：</p>

<ul>
  <li>不同的客户端能使用一样功能的代码</li>
  <li>为了保证安全性，保证有足够权限才能访问</li>
</ul>

<h2 id="常用命令用例-8">常用命令用例</h2>

<p><em>创建food表并插入数据</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>
create table food (
    id int(10) primary key auto_increment,
    name varchar(20) not null,
    company varchar(30) not null,
    price float,
    produce_time year,
    validity_time int(4),
    address varchar(50)
);

insert into food
values(null, 'AA cookie', 'AA factory', 2.5, 2008, 3, 'beijing'),
(null, 'CC Milk', 'CC factory', 3.5, 2009, 1, 'hebei'),
(null, 'EE jelly', 'EE factory', 1.5, 2007, 2, 'beijing'),
(null, 'FF coffee', 'FF factory', 20, 2002, 5, 'tianjin'),
(null, 'GG sugar', 'GG factory', 14, 2003, 3, 'guangdong');

</code></pre>
</div>

<p><em>创建存储过程</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>
delimiter @@

-- be careful the ';' at each statement
create procedure food_price_count(in price_info1 float, in price_info2 float, out count int)
	reads sql data
	begin
		# local variable must be declared first in block
		declare temp float;

		# cursor must be declared after local variable
		declare match_price cursor for select price from food;
		
		# handler must be declared after cursor
		declare exit handler for not found close match_price;
		
		# declare and set a user variable, user variable begin with @
		set @sum=0;

		# select into also can set variable
		select count(*) into count from food where price&gt;price_info1 and price&lt;price_info2;

		open match_price;

		while count&gt;0 do
			fetch match_price into temp;

			if temp&gt;price_info1 and temp&lt;price_info2 then set @sum=@sum+temp;
			end if;
			
			set count = count - 1;
			
		end while;

		close match_price;
		
		select count(*) into count from food where price&gt;price_info1 and price&lt;price_info2;
		
	end;
@@

delimiter ;

</code></pre>
</div>

<p><em>调用存储过程</em></p>

<p><code class="highlighter-rouge">call food_price_count(2,18,@count);</code></p>

<p><em>查看结果</em></p>

<p><code class="highlighter-rouge">select @count, @sum;</code></p>

<p><em>删除存储过程</em></p>

<p><code class="highlighter-rouge">drop procedure food_price_count;</code></p>

<p><em>查看存储过程</em></p>

<p><code class="highlighter-rouge">show create procedure food_price_count \G</code></p>

<p><em>创建存储函数</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>
delimiter @

create function food_price_count(price_info1 float, price_info2 float)
	returns int
	reads sql data
	begin
		return (select count(*) from food where price&gt;price_info1 and price&lt;price_info2);
	end;
@

delimiter ;

</code></pre>
</div>

<p><em>调用存储函数</em></p>

<p><code class="highlighter-rouge">select food_price_count(2,18);</code></p>

<p><em>删除存储函数</em></p>

<p><code class="highlighter-rouge">drop function food_price_count;</code></p>

<p><em>查看存储函数</em></p>

<p><code class="highlighter-rouge">show create function food_price_count \G</code></p>

<h1 id="user-management">User Management</h1>

<p>user表包括用户列(Host, User, Password)，权限列，安全列，资源控制列；管理用户的登录和对所有表的权限，ssl，资源使用限制等；</p>

<p>db和host表包括用户列(host, user)，权限列;管理用户在数据库中的权限；</p>

<p>table_priv表包括用户列(host, user)，权限列；管理用户在表中的权限；</p>

<p>columns_priv表包括用户列(host, user)，权限列；管理用户在列中的权限；</p>

<p>pros_priv表用来管理用户对存储过程和函数的权限；</p>

<p><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html">privilege手册</a></p>

<h2 id="常用命令用例-9">常用命令用例</h2>

<p><em>登陆test数据库</em></p>

<p><code class="highlighter-rouge">mysql -h 59.83.17.100 -u root -p test</code></p>

<p><em>创建用户</em></p>

<p><code class="highlighter-rouge">create user 'test'@'localhost' identified by 'password';</code></p>

<p><em>删除用户</em></p>

<p><code class="highlighter-rouge">drop user 'test'@'localhost';</code></p>

<p><em>root修改自己密码</em></p>

<p><code class="highlighter-rouge">mysqladmin -u root -p password 'new_password'</code></p>

<p><em>root用户修改其他用户密码</em></p>

<p><code class="highlighter-rouge">set password for 'test'@'localhost'=PASSWORD('new_password');</code></p>

<p><em>普通用户修改自己密码</em></p>

<p><code class="highlighter-rouge">set password=PASSWORD('new_password');</code></p>

<p><em>授予查询，更新权限，该用户能给其他用户分与权限</em></p>

<p><code class="highlighter-rouge">grant select, update on *.* to 'test'@'localhost' with grant option;</code></p>

<p><em>回收权限</em></p>

<p><code class="highlighter-rouge">revoke select on *.* from 'test'@'localhost';</code></p>

<p><code class="highlighter-rouge">revoke all privileges, grant option from 'test'@'localhost';</code></p>

<p><em>查看权限</em></p>

<p><code class="highlighter-rouge">show grants for 'test'@'localhost';</code></p>

<h1 id="backup--recovery">Backup &amp; Recovery</h1>

<p>mysqldump命令的原理是根据数据库，表和数据生成一个备份文件，在文件中填入创建数据库，表和insert数据的命令</p>

<p>可以通过直接复制数据库目录的方式来备份MyISAM的表，但需要停掉MySQL服务</p>

<p>可以使用mysqlhotcopy工具来热备份MyISAM类型的表</p>

<p>select into outfile导出表数据到文本文件</p>

<p>SELECT [column name] FROM table [where ..] INTO OUTFILE ‘file’ [OPTION];</p>

<p>mysqldump也能导出数据，使用-X可以导出xml文件</p>

<p>mysqldump -uroot -pPassword -T dirname -X dbname table [option]</p>

<p>可以使用load data infile导入文本数据</p>

<p>LOAD DATA [LOCAL] INFILE file INTO TABLE table [OPTION];</p>

<h2 id="常用命令用例-10">常用命令用例</h2>

<p><em>备份一个数据库中的表</em></p>

<p><code class="highlighter-rouge">mysqldump -uusername -p dbname table1 table2 &gt; backup.sql</code></p>

<p><em>备份多个数据库</em></p>

<p><code class="highlighter-rouge">mysqldump -uusername -p --databases db1 db2 &gt; backup.sql</code></p>

<p><em>备份所有数据库</em></p>

<p><code class="highlighter-rouge">mysqldump -uusername -p --all-databases &gt; backup.sql</code></p>

<p><em>数据恢复</em></p>

<p><code class="highlighter-rouge">mysql -uroot -p &lt; backup.sql</code></p>

<p><em>导出表中的数据，以”、”分隔，”&gt;”开头，字符型数据用双引号括注</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>select * from test.student into outfile '/tmp/data' fields terminated by '\、' optionally enclosed by '\"' lines starting by '\&gt;' terminated by '\r\n';
</code></pre>
</div>

<p><em>导入表的数据</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>load data infile '/tmp/file' into table student fields terminated by '\、' optionally enclosed by '\"' lines starting by '\&gt;' terminated by '\r\n'
</code></pre>
</div>

<h1 id="log">Log</h1>

<p>MySQL有四种日志，除二进制日志外其他都是文本日志，默认只启动错误日志，因为日志会降低性能：</p>

<ul>
  <li>二进制日志：把数据库的操作信息(不包括查询)存储在二进制日志文件中</li>
  <li>错误日志：记录MySQL的启动，关闭和运行错误信息</li>
  <li>通用查询日志：记录用户登陆，操作和查询数据库的信息</li>
  <li>慢查询日志：记录执行超过指定时间的操作信息</li>
</ul>

<p>二进制日志最好单独存放于其他磁盘，可以用来恢复数据库</p>

<h2 id="常用命令用例-11">常用命令用例</h2>

<p><em>在my.cnf或my.ini中启用二进制日志</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>[mysqld]
log-bin=/tmp/b_log
</code></pre>
</div>

<p><em>查看二进制日志</em></p>

<p><code class="highlighter-rouge">mysqlbinlog /tmp/b_log.000001;</code></p>

<p><em>删除所有二进制记录</em></p>

<p><code class="highlighter-rouge">reset master;</code></p>

<p><em>删除某一个二进制日志文件</em></p>

<p><code class="highlighter-rouge">purge master logs to '/tmp/b_log.000001'；</code></p>

<p><em>删除某个日期前创建的二进制日志</em></p>

<p><code class="highlighter-rouge">purge master logs to '2017-08-01 11:00:00'；</code></p>

<p><em>用二进制日志恢复数据库</em></p>

<p><code class="highlighter-rouge">mysqlbinlog b_log.000001 | mysql -uroot -p</code></p>

<p><em>暂停和恢复二进制日志</em></p>

<p><code class="highlighter-rouge">set sql_bin_log = 0</code></p>

<p><code class="highlighter-rouge">set sql_bin_log = 1</code></p>

<p><em>在my.cnf或my.ini中启用错误日志</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>[mysqld]
log-error=/tmp/err_log
</code></pre>
</div>

<p><em>重新创建错误日志文件，旧的日志文件被改名，可删掉或备份</em></p>

<p><code class="highlighter-rouge">mysqladmin -uroot -p flush-logs</code></p>

<p><em>在my.cnf或my.ini中启用通用查询日志</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>[mysqld]
log=/tmp/search_log
</code></pre>
</div>

<p><em>重新创建通用查询日志文件，旧的日志文件被删掉</em></p>

<p><code class="highlighter-rouge">mysqladmin -uroot -p flush-logs</code></p>

<p><em>在my.cnf或my.ini中启用慢查询日志</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>[mysqld]
log-slow-queries=/tmp/slow_queries_log
long_query_time=1
</code></pre>
</div>

<p><em>重新创建慢查询日志文件，旧的日志文件被删掉</em></p>

<p><code class="highlighter-rouge">mysqladmin -uroot -p flush-logs</code></p>

<h1 id="performance">Performance</h1>

<p>索引经常用来优化条件查询，排序等；使用索引查询记录时，要注意索引的使用情况。like条件的字符串不能以通配符%开头，否则不会启用索引；使用多列索引时，查询条件的要用多列索引中的第一个字段才会启用索引；OR所连接的所有查询条件都要用索引的字段才会启用。</p>

<p>改变数据库的表结构，通过增加冗余来优化数据库的访问，这种方法适合查询远多于修改的情况：</p>

<ul>
  <li>在字段多的表中，把常用字段和不常用字段分成两个表</li>
  <li>为经常需要进行连接查询的多个表创建一个中间表减少连接查询</li>
  <li>为表增加冗余字段减少表连接</li>
  <li>插入大量数据时可以先禁用索引和唯一性检查，完成以后再重新启用</li>
</ul>

<h2 id="常用命令用例-12">常用命令用例</h2>

<p><em>查看InnoDB表的查询记录数和更新记录数，慢查询数，连接数</em></p>

<p><code class="highlighter-rouge">show status like 'Innodb_rows_read' \G</code></p>

<p><code class="highlighter-rouge">show status like 'Innodb_rows_updated' \G</code></p>

<p><code class="highlighter-rouge">show status like 'Slow_queries' \G</code></p>

<p><code class="highlighter-rouge">show status like 'Connections' \G</code></p>

<p><em>分析查询语句的性能</em></p>

<p><code class="highlighter-rouge">explain select * from score where stu_id=96;</code></p>

<p><em>分析score表</em></p>

<p><code class="highlighter-rouge">analyze table score;</code></p>

<p><em>检查score表</em></p>

<p><code class="highlighter-rouge">check table score;</code></p>

<p><em>优化score表</em></p>

<p><code class="highlighter-rouge">optimize table score;</code></p>

            </article>
        </div>
      </div>
      <div class="panel docs-content">
        <article class="post-content">
          <div class="wrapper">
            


  <div class="ds-thread" data-thread-key="/2017/05/13/MySQL%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" data-title="MySQL基本知识" data-url="/2017/05/13/MySQL%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/"></div>

<script type="text/javascript">
var duoshuoQuery = {short_name:"junxigu"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>


 
          </div>
        </article>
      </div>
    </div>
  </div>
</div>

    
    <footer class="footer" role="contentinfo">
	<div class="container">
		<p class="copyright">Copyright &copy; 2014-2017 <a href=""><code>Jun Xi Gu</code></a>.</p>
		<p>Customizied from <a href="https://github.com/luoyan35714/LessOrMore">LessOrMore</a></p></p>
		<p>Powered by <a href="http://jekyllrb.com">Jekyll</a>, theme from <a href="http://lesscss.cn/">Less</a></p>
	</div>
</footer>

<script src="/styles/js/jquery.min.js"></script>
<script src="/styles/js/bootstrap.min.js"></script>
<script src="/styles/js/holder.min.js"></script>
<script src="/styles/js/application.js"></script>
<script src="/styles/js/lessismore.js"></script>

  </body>
</html>
